// frontend/src/components/Dashboard.tsx
/**
 * ContentFlow Dashboard
 * Main application interface with input, processing status, and content preview.
 * Uses Framer Motion for smooth animations and glassmorphism design.
 */

import React, { useState, useCallback, useEffect } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import { Upload, Sparkles, ArrowRight, CheckCircle, AlertCircle } from 'lucide-react'

import InputForm from './InputForm'
import ProcessingStatus from './ProcessingStatus'\nimport ContentPreview from './ContentPreview'\nimport AnimatedBackground from './AnimatedBackground'\nimport { useContentGeneration } from '../hooks/useContentGeneration'\nimport { useWebSocket } from '../hooks/useWebSocket'\nimport type { ProcessingJob, Content } from '../types'\n\ninterface DashboardProps {}\n\nconst Dashboard: React.FC<DashboardProps> = () => {\n  const [currentStep, setCurrentStep] = useState<'input' | 'processing' | 'preview'>('input')\n  const [selectedContent, setSelectedContent] = useState<Content | null>(null)\n  const [processingJob, setProcessingJob] = useState<ProcessingJob | null>(null)\n\n  const { generateContent, loading: generationLoading, error: generationError } = useContentGeneration()\n  const { message: wsMessage, isConnected: wsConnected } = useWebSocket()\n\n  // Update processing status from WebSocket\n  useEffect(() => {\n    if (wsMessage?.type === 'progress') {\n      setProcessingJob(prev => prev ? {\n        ...prev,\n        progress_percent: wsMessage.data.progress,\n        current_step: wsMessage.data.step,\n      } : null)\n    } else if (wsMessage?.type === 'complete') {\n      setProcessingJob(prev => prev ? {\n        ...prev,\n        status: 'completed',\n        progress_percent: 100,\n      } : null)\n      setCurrentStep('preview')\n    } else if (wsMessage?.type === 'error') {\n      setProcessingJob(prev => prev ? {\n        ...prev,\n        status: 'failed',\n        error_message: wsMessage.data.error,\n      } : null)\n    }\n  }, [wsMessage])\n\n  const handleGenerateContent = useCallback(async (formData: any) => {\n    try {\n      setCurrentStep('processing')\n      const result = await generateContent(formData)\n      setProcessingJob({\n        id: result.job_id,\n        content_id: result.content_id,\n        status: 'processing',\n        progress_percent: 0,\n        current_step: 'Initializing...',\n        created_at: new Date(),\n      })\n    } catch (error) {\n      console.error('Generation failed:', error)\n      setCurrentStep('input')\n    }\n  }, [generateContent])\n\n  const handleBackToInput = useCallback(() => {\n    setCurrentStep('input')\n    setSelectedContent(null)\n    setProcessingJob(null)\n  }, [])\n\n  const containerVariants = {\n    hidden: { opacity: 0 },\n    visible: {\n      opacity: 1,\n      transition: {\n        staggerChildren: 0.2,\n        delayChildren: 0.3,\n      },\n    },\n  }\n\n  const itemVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: {\n        duration: 0.6,\n        ease: 'easeOut',\n      },\n    },\n  }\n\n  return (\n    <div className=\"relative min-h-screen overflow-hidden bg-slate-950\">\n      {/* Animated background */}\n      <AnimatedBackground />\n\n      {/* Main content */}\n      <motion.div\n        className=\"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\"\n        variants={containerVariants}\n        initial=\"hidden\"\n        animate=\"visible\"\n      >\n        {/* Header */}\n        <motion.div\n          className=\"text-center mb-16\"\n          variants={itemVariants}\n        >\n          <motion.div\n            className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 border border-emerald-500/30 mb-6\"\n            whileHover={{ scale: 1.05 }}\n            transition={{ duration: 0.3 }}\n          >\n            <Sparkles className=\"w-4 h-4 text-emerald-400\" />\n            <span className=\"text-sm font-medium text-emerald-300\">Powered by AI</span>\n          </motion.div>\n\n          <h1 className=\"text-5xl sm:text-6xl lg:text-7xl font-bold mb-4 bg-gradient-to-r from-white via-emerald-200 to-cyan-200 bg-clip-text text-transparent\">\n            ContentFlow\n          </h1>\n          <p className=\"text-xl text-slate-400 max-w-2xl mx-auto\">\n            Transform videos and articles into viral social media content instantly\n          </p>\n        </motion.div>\n\n        {/* Step indicator */}\n        <motion.div\n          className=\"flex justify-center gap-8 mb-12\"\n          variants={itemVariants}\n        >\n          {(['input', 'processing', 'preview'] as const).map((step, idx) => (\n            <div key={step} className=\"flex items-center gap-4\">\n              <motion.div\n                className={`w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg transition-all duration-300 ${\n                  currentStep === step\n                    ? 'bg-gradient-to-r from-emerald-500 to-cyan-500 text-white scale-125'\n                    : currentStep > step || step === 'input'\n                    ? 'bg-emerald-500/30 text-emerald-300 border border-emerald-500/50'\n                    : 'bg-slate-700/50 text-slate-500 border border-slate-600/50'\n                }`}\n                whileHover={{ scale: 1.05 }}\n              >\n                {step === 'input' ? <Upload className=\"w-6 h-6\" /> : idx + 1}\n              </motion.div>\n              {idx < 2 && (\n                <motion.div\n                  className={`w-16 h-1 rounded-full transition-all duration-300 ${\n                    currentStep > step\n                      ? 'bg-emerald-500'\n                      : 'bg-slate-700/50'\n                  }`}\n                  initial={{ scaleX: 0 }}\n                  animate={{ scaleX: currentStep > step ? 1 : 0 }}\n                />\n              )}\n            </div>\n          ))}\n        </motion.div>\n\n        {/* Main content area */}\n        <motion.div\n          className=\"relative\"\n          variants={itemVariants}\n        >\n          <AnimatePresence mode=\"wait\">\n            {/* Input Step */}\n            {currentStep === 'input' && (\n              <motion.div\n                key=\"input\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                transition={{ duration: 0.4 }}\n              >\n                <InputForm onSubmit={handleGenerateContent} isLoading={generationLoading} />\n                {generationError && (\n                  <motion.div\n                    className=\"mt-6 p-4 rounded-lg bg-red-500/10 border border-red-500/30 flex items-gap-3\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                  >\n                    <AlertCircle className=\"w-5 h-5 text-red-400 flex-shrink-0\" />\n                    <p className=\"text-red-300 text-sm\">{generationError}</p>\n                  </motion.div>\n                )}\n              </motion.div>\n            )}\n\n            {/* Processing Step */}\n            {currentStep === 'processing' && processingJob && (\n              <motion.div\n                key=\"processing\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                transition={{ duration: 0.4 }}\n              >\n                <ProcessingStatus job={processingJob} wsConnected={wsConnected} />\n              </motion.div>\n            )}\n\n            {/* Preview Step */}\n            {currentStep === 'preview' && processingJob && (\n              <motion.div\n                key=\"preview\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                transition={{ duration: 0.4 }}\n              >\n                <ContentPreview job={processingJob} onBack={handleBackToInput} />\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </motion.div>\n\n        {/* Footer CTA */}\n        {currentStep === 'input' && (\n          <motion.div\n            className=\"mt-16 text-center\"\n            variants={itemVariants}\n          >\n            <p className=\"text-slate-500 text-sm mb-4\">\n              ðŸ’¡ Tip: Use high-quality video transcripts for best results\n            </p>\n          </motion.div>\n        )}\n      </motion.div>\n\n      {/* Floating elements */}\n      <FloatingElements />\n    </div>\n  )\n}\n\nconst FloatingElements: React.FC = () => {\n  return (\n    <>\n      {/* Floating orbs */}\n      <motion.div\n        className=\"absolute top-20 left-10 w-64 h-64 rounded-full bg-emerald-500/10 blur-3xl\"\n        animate={{\n          y: [0, 30, 0],\n          x: [0, 20, 0],\n        }}\n        transition={{\n          duration: 8,\n          repeat: Infinity,\n          ease: 'easeInOut',\n        }}\n      />\n      <motion.div\n        className=\"absolute bottom-20 right-10 w-96 h-96 rounded-full bg-cyan-500/10 blur-3xl\"\n        animate={{\n          y: [0, -30, 0],\n          x: [0, -20, 0],\n        }}\n        transition={{\n          duration: 10,\n          repeat: Infinity,\n          ease: 'easeInOut',\n        }}\n      />\n    </>\n  )\n}\n\nexport default Dashboard
